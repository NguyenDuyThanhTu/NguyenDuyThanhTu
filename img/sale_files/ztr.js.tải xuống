(()=>{"use strict";class t{static mapFunc=new Map([["CLICK_ID",t.getClickId],["CLICK_TEXT",t.getClickText],["CLICK_URL",t.getClickUrl],["CLICK_CLASSES",t.getClickClasses],["CLICK_ELEMENT",t.getClickElement],["PAGE_URL",t.getPageUrl],["PAGE_PATH",t.getPagePath]]);constructor(t){this.event=t}getVariableValue(e){return t.mapFunc.get(e)(this.event)}getAllVariableValue(){let e={};return t.mapFunc.forEach(((t,n)=>{e[n]=t(this.event)})),e}static getClickId(t){return t.target?.id}static getClickText(t){return t.target?.innerText}static getClickUrl(t){return function(t){for(;t;){if(t.href&&t.nodeName.match(/^a$/i))return t.href;t=t.parentNode}}(t.target)}static getClickClasses(t){return t.target?.className}static getClickElement(t){var e=t.composedPath?t.composedPath():t.path;if(e)return e.slice(0,e.length-2).map((t=>{let e=t.tagName?.toLowerCase();return t.classList?.forEach((t=>e+="."+t)),e})).reverse().join(" > ")}static getPageUrl(t){return window.location.href}static getPagePath(t){return window.location.pathname}}class e{constructor(t){this.name=t.name,this.action=t.action}isMatch(t,e){return t===this.action.type&&this.isMatchRules(e)}isMatchRules(t){for(let n of this.action.rules)if(!e.isMatchRule(n,t))return!1;return!0}static isMatchRule(e,n){let a=new t(n).getVariableValue(e.variable);if(null==a)return!1;switch(e.operator){case"CONTAINS":return a.includes(e.value);case"DOES_NOT_CONTAIN":return!a.includes(e.value);case"EQUAL":return a instanceof Array?a.join(" ")===e.value:a===e.value;default:return!1}}}const n="576913441152754454",a="https://px.dmp.zaloapp.com",r="zutm_info",i="zdmp_pssid",o="zdmp_lsrcref",s="zdmp_page_view",c=[{name:"Pageview",action:{type:"PAGE_VIEW",rules:[{variable:"PAGE_URL",operator:"CONTAINS",value:"www.nguyenkim.com"}],name:"Pageview"}}].map((t=>new e(t))),l="ztr_debug",d="ztr_pixel";function u(){var t;function e(){t!==window.location.href&&(t=window.location.href,document.dispatchEvent(new CustomEvent(s)))}function n(t,e){e.isMatchRules(t)&&window.ztr("track",e.name)}c.forEach((t=>{!function(t){switch(t.action.type){case"CLICK":document.addEventListener("click",(e=>{n(e,t)}),!0);break;case"PAGE_VIEW":document.addEventListener(s,(e=>{n(e,t)}))}}(t)})),window.history.pushState=new Proxy(window.history.pushState,{apply:(t,n,a)=>{t.apply(n,a),e()}}),window.history.replaceState=new Proxy(window.history.replaceState,{apply:(t,n,a)=>{t.apply(n,a),e()}}),window.onpopstate=function(t){e()},e()}const p=function(t){return Object.keys(t).filter((e=>null!==t[e]&&void 0!==t[e])).map((function(e){return[e,encodeURIComponent(t[e])].join("=")})).join("&")};class m{constructor(t){this.baseUrl=t,this.params={}}addParam(t,e){this.params[t]=e}addParams(t){Object.assign(this.params,t)}get(){let t=new Image;t.referrerPolicy="unsafe-url",t.src=this.baseUrl+p(this.params)}}function g(){var e=window.location.search;const r=new URLSearchParams(e),i=r.get(l)?r.get(l):sessionStorage.getItem(l),o=r.get(d)?r.get(d):sessionStorage.getItem(d);if(!i)return;String.prototype.format=function(){var t=arguments;return this.replace(/{([0-9]+)}/g,(function(e,n){return void 0===t[n]?e:t[n]}))},function(t){let e;e=t?t===n?`Pixel ${t} connected`:`Pixel ${t} not installed`:"Pixel debug not found";const a=document.createElement("iframe");a.srcdoc='<!DOCTYPE html>\n<html lang="en">\n<head>\n    <title>Zalo DMP Debug</title>\n    <style>\n\n        body {\n            margin: 0;\n            font-family: Roboto,Helvetica Neue,Helvetica,Arial,sans-serif\n        }\n        .panel {\n            border-color: #ddd;\n            color: #333;\n        }\n\n        .panel-default {\n            border-color: #ddd;\n        }\n\n        .panel {\n            background-color: #fff;\n            border-radius: 3px;\n        }\n\n        .panel-default > .panel-heading {\n            color: #fff;\n            background-color: #2196f3;\n            border-color: #ddd;\n        }\n\n        .panel-heading {\n            position: relative;\n            border-top-right-radius: 3px;\n            border-top-left-radius: 3px;\n        }\n\n        .panel-heading {\n            padding: 15px 20px;\n            border-bottom: 1px solid transparent;\n            border-top-right-radius: 2px;\n            border-top-left-radius: 2px;\n        }\n\n        .h1.panel-title, h1.panel-title {\n            font-size: 20px;\n        }\n\n        .panel-title {\n            position: relative;\n        }\n\n        .panel-title {\n            margin-top: 0;\n            margin-bottom: 0;\n            color: inherit;\n        }\n\n        .panel-body {\n            position: relative;\n            font-size: 13px;\n        }\n\n        .panel-body {\n            padding: 15px;\n        }\n    </style>\n</head>\n<body>\n<div class="panel panel-default">\n    <div class="panel-heading">\n        <h1 class="panel-title">Zalo DMP Pixel Debug<a class="heading-elements-toggle"><i class="icon-more"></i></a></h1>\n    </div>\n\n    <div class="panel-body" style="">\n        {0}\n    </div>\n</div>\n</body>\n</html>\n'.format(e),a.style="border: 0px !important; inset: auto 24px 24px auto !important; border-radius: 8px !important; box-shadow: rgba(0, 0, 0, 0.2) 0px 3px 5px -1px, rgba(0, 0, 0, 0.14) 0px 5px 8px 0px, rgba(0, 0, 0, 0.12) 0px 1px 14px 0px !important; clip: initial !important; display: inline !important; height: 100px !important; margin: 0px !important; max-width: 95% !important; opacity: 1 !important; padding: 0px !important; position: fixed !important; visibility: visible !important; width: 300px !important; z-index: 2147483647 !important;",document.body.appendChild(a)}(o),sessionStorage.setItem(l,i),sessionStorage.setItem(d,o),document.addEventListener("click",(t=>{u("CLICK",t)}),!0),document.addEventListener(s,(t=>{u("PAGE_VIEW",t)}));const u=function(e,r){let o=new t(r).getAllVariableValue(),s=[],d=[];c.forEach((t=>{t.isMatch(e,r)?s.push(t.name):d.push(t.name)}));let u=new m(a+"/tr_debug?");u.addParam("id",n),u.addParam("event",e),u.addParam("time",Date.now()),u.addParam(l,i),u.addParams(o),u.addParam("eventsFired",s),u.addParam("eventsNotFired",d),u.get()}}!function t(e,s,c,l,d){if(!c){e.ztr("track","__ZDMP_INIT_PIXEL__"),g(),u();const t=e.location.search,n=new URLSearchParams(t),a=n.get("zutm_source"),i=n.get("zutm_medium"),c=n.get("zutm_campaign"),l=n.get("zutm_audience");if(a&&c){const t={zutm_source:a,zutm_medium:i,zutm_campaign:c,zutm_audience:l,zutm_initTime:Date.now()};localStorage.setItem(r,e.btoa(JSON.stringify(t))),e.ztr("track","__ZDMP_INIT_UTM__")}if(n.get("ztr_verify")&&e.ztr("track","__ZDMP_VERIFY__"),s.referrer){const t=new URL(s.referrer);t.origin!==s.location.origin&&s.referrer!==localStorage.getItem(o)&&localStorage.setItem(o,t.origin)}}if(!e.ZA){c||((d=s.createElement("script")).type="text/javascript",d.src="https://za.zdn.vn/v3/za.js?v=2.0",d.async=!1,(l=s.getElementsByTagName("script")[0]).parentNode.insertBefore(d,l),c=setInterval((function(){t(e,s,c)}),2e3));var m=e.ztr.queue||[];return e.ztr=function(t,n,a){e.ztr.queue.push({action:"track",event:n?String(n):"",arguments:Object.assign({},a)})},void(e.ztr.queue=m||[])}c&&clearInterval(c);var f=e.ztr.queue||[];e.ztr=function(r,i,c){switch(r){case"init":localStorage.setItem("zdmp_pid",""+i);break;case"track":if(!e.ZA)return e.ztr.queue=e.ztr.queue||[],e.ztr.queue.push({action:"track",event:i?String(i):"",arguments:Object.assign({},c)}),void t(e,s);let l={};l.id=n,l.event=i,h(l,c),l.sessionId=v(),l.time=Date.now(),x(l),l.version="2.0",l.zscript=1,l.lastsrcref=localStorage.getItem(o),e.ZA.getVisitorID((function(t){l.vid=t;let e=new Image;e.referrerPolicy="unsafe-url",e.src=a+"/tr?"+p(l)}));break;default:console.log("Unsupported action: "+r)}},ztr.callMethod=ztr;const h=function(t,e){Object.keys(e||{}).forEach((n=>{t["p["+n+"]"]=e[n]}))},x=function(t){const n=localStorage.getItem(r);if(!n)return;const a=JSON.parse(e.atob(n));a.zutm_windowTime=Date.now()-a.zutm_initTime,Object.keys(a).forEach((e=>{t[e]=a[e]}))},v=function(){let t=sessionStorage.getItem(i);return t||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:11&e).toString(16)})),sessionStorage.setItem(i,t)),t};f.length&&(f.forEach((function(t){ztr(t.action,t.event,t.args)})),e.ztr.queue=[])}(window,document)})();
